---
tags:
  - not_impl
  - clickhouse
---



# Гранула

ClickHouse использует индексы для ускорения поиска данных в огромных объемах, но они работают не так, как традиционные индексы в реляционных базах данных. Индексы в ClickHouse — это указатели на диапазоны данных (грубо говоря, с какого блока физически начинать читать данные) - **Гранулы**.

---
#### `index_granularity` и Поиск
Поиск происходит по минимальным неделимым частицам в Кликхаусе - _Гранулам_, это группа объектов из представления хранения в бд. Каждая гранула имеет свой определенной признак _ключа сортировки_, по которой и происходит поиск. Все данные хранятся _локально_ на уровне физ хранилища. 
**Параметр `index_granularity`** в ClickHouse определяет, с какой детализацией (гранулярностью) создаются индексы в таблицах с [[MergedTree движок]] (и его разновидностями, такими как ReplacingMergeTree, SummingMergeTree и другие). _Он указывает, через какое количество строк в сегменте данных будет записываться "запись индекса" для ускорения выборок._
![[Pasted image 20241214001754.png]]
#### Как работает `index_granularity`?
- Таблица с движком MergeTree хранит данные в блоках, где каждая строка имеет смещение.
- `index_granularity` задаёт интервал строк, после которых создаётся запись индекса.
- При запросе ClickHouse смотрит, какие диапазоны данных нужно прочитать, используя этот индекс.
- Если `index_granularity` больше, индекс занимает меньше места, но запросы могут читать больше данных.
- Если `index_granularity` меньше, индекс занимает больше места, но запросы быстрее пропускают ненужные данные.
#### Тонкости выбора `index_granularity`
- **Большое значение (`>8192`)**:
    - Уменьшает объем индекса, что снижает нагрузку на память.
    - Но увеличивает объем данных, которые могут быть "лишними" при чтении.
- **Малое значение (`<8192`)**:
    - Ускоряет выборки, так как ClickHouse читает меньше ненужных данных.
    - Индекс занимает больше места.
* Используйте **меньшее значение** для таблиц с часто запрашиваемыми фильтрами, чтобы ускорить выборки.
- Используйте **большее значение** для таблиц с большим объемом данных, чтобы снизить нагрузку на память.
